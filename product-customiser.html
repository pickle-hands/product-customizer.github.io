<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Product Customiser</title>
<link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;600&family=Playfair+Display:wght@600&display=swap" rel="stylesheet"/>
<style>
  *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

  :root {
    --bg: #f4f1ed;
    --surface: #ffffff;
    --text: #1a1a1a;
    --text-muted: #7a756e;
    --accent: #2a2a2a;
    --accent-hover: #444;
    --border: #e0dbd4;
    --shadow: 0 2px 24px rgba(0,0,0,0.06);
    --shadow-lg: 0 8px 40px rgba(0,0,0,0.10);
    --radius: 14px;
  }

  body {
    font-family: 'DM Sans', sans-serif;
    background: var(--bg);
    color: var(--text);
    min-height: 100vh;
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 24px;
  }

  .container {
    background: var(--surface);
    border-radius: var(--radius);
    box-shadow: var(--shadow-lg);
    max-width: 560px;
    width: 100%;
    overflow: hidden;
    animation: fadeUp 0.4s cubic-bezier(0.22,1,0.36,1);
  }

  @keyframes fadeUp {
    from { opacity:0; transform: translateY(18px); }
    to   { opacity:1; transform: translateY(0); }
  }

  /* Header */
  .header {
    padding: 28px 28px 0;
    text-align: center;
  }
  .header h1 {
    font-family: 'Playfair Display', serif;
    font-size: 1.6rem;
    letter-spacing: -0.02em;
    color: var(--text);
  }
  .header p {
    font-size: 0.82rem;
    color: var(--text-muted);
    margin-top: 6px;
    line-height: 1.5;
  }

  /* Canvas area */
  .canvas-wrap {
    position: relative;
    margin: 24px 28px 0;
    background: var(--bg);
    border-radius: 10px;
    border: 1px solid var(--border);
    overflow: hidden;
    aspect-ratio: 1;
    cursor: crosshair;
  }
  .canvas-wrap canvas {
    display: block;
    width: 100%;
    height: 100%;
  }

  /* Placeholder overlay (shown before upload) */
  .placeholder {
    position: absolute;
    inset: 0;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    pointer-events: none;
    transition: opacity 0.3s;
  }
  .placeholder.hidden { opacity: 0; }
  .placeholder svg { width: 40px; height: 40px; opacity: 0.22; margin-bottom: 10px; }
  .placeholder span { font-size: 0.78rem; color: var(--text-muted); }

  /* Controls */
  .controls {
    display: flex;
    flex-direction: column;
    gap: 12px;
    padding: 22px 28px 28px;
  }

  .btn-row {
    display: flex;
    gap: 10px;
  }

  .btn {
    flex: 1;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 7px;
    padding: 11px 16px;
    border-radius: 8px;
    border: 1.5px solid var(--border);
    background: var(--surface);
    color: var(--text);
    font-family: inherit;
    font-size: 0.8rem;
    font-weight: 500;
    cursor: pointer;
    transition: all 0.18s ease;
  }
  .btn:hover { border-color: var(--accent); background: #fafaf8; }
  .btn svg { width: 15px; height: 15px; opacity: 0.6; }

  .btn-primary {
    background: var(--accent);
    color: #fff;
    border-color: var(--accent);
  }
  .btn-primary:hover { background: var(--accent-hover); border-color: var(--accent-hover); }
  .btn-primary svg { opacity: 0.85; }

  .btn-danger { color: #c0392b; }
  .btn-danger:hover { border-color: #c0392b; background: #fdf2f1; }

  /* Slider row */
  .slider-row {
    display: flex;
    align-items: center;
    gap: 12px;
  }
  .slider-row label {
    font-size: 0.76rem;
    color: var(--text-muted);
    white-space: nowrap;
    min-width: 52px;
  }
  .slider-row input[type="range"] {
    flex: 1;
    -webkit-appearance: none;
    appearance: none;
    height: 3px;
    border-radius: 2px;
    background: var(--border);
    outline: none;
  }
  .slider-row input[type="range"]::-webkit-slider-thumb {
    -webkit-appearance: none;
    appearance: none;
    width: 16px; height: 16px;
    border-radius: 50%;
    background: var(--accent);
    cursor: pointer;
    box-shadow: 0 1px 4px rgba(0,0,0,0.2);
    transition: transform 0.15s;
  }
  .slider-row input[type="range"]::-webkit-slider-thumb:hover { transform: scale(1.15); }

  .hint {
    font-size: 0.72rem;
    color: var(--text-muted);
    text-align: center;
    opacity: 0.7;
  }

  /* Hidden file input */
  #fileInput { display: none; }
</style>
</head>
<body>

<div class="container">
  <div class="header">
    <h1>Personalise Your Product</h1>
    <p>Upload an image to see how it looks on the product.<br/>Drag to reposition · Use the slider to resize.</p>
  </div>

  <div class="canvas-wrap" id="canvasWrap">
    <canvas id="canvas"></canvas>
    <div class="placeholder" id="placeholder">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
        <rect x="3" y="3" width="18" height="18" rx="2"/>
        <circle cx="8.5" cy="8.5" r="1.5"/>
        <path d="M21 15l-5-5L5 21"/>
      </svg>
      <span>Your preview will appear here</span>
    </div>
  </div>

  <div class="controls">
    <div class="btn-row">
      <button class="btn btn-primary" onclick="document.getElementById('fileInput').click()">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="17 8 12 3 7 8"/><line x1="12" y1="3" x2="12" y2="15"/></svg>
        Upload Image
      </button>
      <button class="btn btn-danger" id="clearBtn" onclick="clearImage()" style="display:none;">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="3 6 5 6 21 6"/><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/></svg>
        Clear
      </button>
    </div>

    <div class="slider-row" id="sliderRow" style="display:none;">
      <label>Size</label>
      <input type="range" id="sizeSlider" min="30" max="300" value="140" oninput="render()"/>
    </div>

    <input type="file" id="fileInput" accept="image/*" onchange="handleUpload(event)"/>
    <p class="hint">Supported: JPG, PNG, WEBP · Max 10 MB</p>
  </div>
</div>

<script>
// ─── STATE ───────────────────────────────────
const canvas   = document.getElementById('canvas');
const ctx      = canvas.getContext('2d');
const wrap     = document.getElementById('canvasWrap');

let productImg = null;   // base product image
let userImg    = null;   // customer's uploaded image
let imgX, imgY, imgSize; // position & size of user image
let dragging   = false;
let dragOffX   = 0, dragOffY = 0;

// ─── SETUP ───────────────────────────────────
// Set canvas resolution to match CSS size (crisp rendering)
function resizeCanvas() {
  const rect = wrap.getBoundingClientRect();
  canvas.width  = rect.width;
  canvas.height = rect.height;
  render();
}
window.addEventListener('resize', resizeCanvas);

// ─── PRODUCT BASE IMAGE ──────────────────────
// This is a simple placeholder product (a white mug drawn with canvas).
// Replace this function with: productImg = new Image(); productImg.src = 'your-product.png';
function drawPlaceholderProduct() {
  const w = canvas.width, h = canvas.height;
  ctx.clearRect(0,0,w,h);

  // Shadow
  ctx.shadowColor = 'rgba(0,0,0,0.08)';
  ctx.shadowBlur  = 18;
  ctx.shadowOffsetY = 6;

  // Mug body
  ctx.fillStyle = '#fff';
  ctx.beginPath();
  const mx = w*0.28, my = h*0.22, mw = w*0.44, mh = h*0.58;
  ctx.roundRect(mx, my, mw, mh, 12);
  ctx.fill();

  // Mug handle
  ctx.strokeStyle = '#fff';
  ctx.lineWidth = w*0.055;
  ctx.lineCap = 'round';
  ctx.beginPath();
  ctx.arc(mx+mw+8, my+mh*0.35, mh*0.22, -0.55, 0.55);
  ctx.stroke();

  ctx.shadowColor = 'transparent';
  ctx.shadowBlur  = 0;
  ctx.shadowOffsetY = 0;

  // Mug rim
  ctx.fillStyle = '#e8e3dc';
  ctx.beginPath();
  ctx.ellipse(mx+mw/2, my, mw/2, 10, 0, 0, Math.PI*2);
  ctx.fill();
  ctx.fillStyle = '#fff';
  ctx.beginPath();
  ctx.ellipse(mx+mw/2, my, mw/2-3, 7, 0, 0, Math.PI*2);
  ctx.fill();

  // Label area (subtle indicator)
  ctx.fillStyle = 'rgba(42,42,42,0.04)';
  ctx.beginPath();
  ctx.roundRect(mx+mw*0.12, my+mh*0.18, mw*0.76, mh*0.52, 6);
  ctx.fill();

  ctx.fillStyle = 'rgba(42,42,42,0.12)';
  ctx.font = '11px DM Sans, sans-serif';
  ctx.textAlign = 'center';
  ctx.fillText('Your image here', mx+mw/2, my+mh*0.48);
}

// ─── RENDER LOOP ─────────────────────────────
function render() {
  const w = canvas.width, h = canvas.height;

  if (productImg) {
    ctx.clearRect(0,0,w,h);
    ctx.drawImage(productImg, 0, 0, w, h);
  } else {
    drawPlaceholderProduct();
  }

  // Draw user image if uploaded
  if (userImg) {
    document.getElementById('placeholder').classList.add('hidden');
    const size = parseInt(document.getElementById('sizeSlider').value);
    const aspect = userImg.naturalWidth / userImg.naturalHeight;
    const dw = size;
    const dh = size / aspect;
    imgSize = size;

    // Clip to the mug label area (approximate)
    const mx = w*0.28, my = h*0.22, mw = w*0.44, mh = h*0.58;
    ctx.save();
    ctx.beginPath();
    ctx.roundRect(mx+mw*0.12, my+mh*0.18, mw*0.76, mh*0.52, 6);
    ctx.clip();

    ctx.drawImage(userImg, imgX - dw/2, imgY - dh/2, dw, dh);
    ctx.restore();
  }
}

// ─── FILE UPLOAD ─────────────────────────────
function handleUpload(e) {
  const file = e.target.files[0];
  if (!file || file.size > 10*1024*1024) return alert('Please use an image under 10 MB.');

  const reader = new FileReader();
  reader.onload = function(ev) {
    const img = new Image();
    img.onload = function() {
      userImg = img;
      // Default position: center of canvas
      imgX = canvas.width / 2;
      imgY = canvas.height / 2;
      document.getElementById('sliderRow').style.display = 'flex';
      document.getElementById('clearBtn').style.display  = 'flex';
      render();
    };
    img.src = ev.target.result;
  };
  reader.readAsDataURL(file);
  e.target.value = ''; // reset so same file can be re-uploaded
}

// ─── CLEAR ───────────────────────────────────
function clearImage() {
  userImg = null;
  document.getElementById('sliderRow').style.display = 'none';
  document.getElementById('clearBtn').style.display  = 'none';
  document.getElementById('placeholder').classList.remove('hidden');
  render();
}

// ─── DRAG & DROP (reposition) ────────────────
function getPos(e) {
  const rect = canvas.getBoundingClientRect();
  const scaleX = canvas.width  / rect.width;
  const scaleY = canvas.height / rect.height;
  const clientX = e.touches ? e.touches[0].clientX : e.clientX;
  const clientY = e.touches ? e.touches[0].clientY : e.clientY;
  return {
    x: (clientX - rect.left) * scaleX,
    y: (clientY - rect.top)  * scaleY
  };
}

function onDown(e) {
  if (!userImg) return;
  e.preventDefault();
  const pos = getPos(e);
  dragging = true;
  dragOffX = pos.x - imgX;
  dragOffY = pos.y - imgY;
  wrap.style.cursor = 'grabbing';
}

function onMove(e) {
  if (!dragging) return;
  e.preventDefault();
  const pos = getPos(e);
  imgX = pos.x - dragOffX;
  imgY = pos.y - dragOffY;
  render();
}

function onUp(e) {
  dragging = false;
  wrap.style.cursor = 'crosshair';
}

canvas.addEventListener('mousedown',  onDown);
canvas.addEventListener('mousemove',  onMove);
canvas.addEventListener('mouseup',    onUp);
canvas.addEventListener('mouseleave', onUp);
canvas.addEventListener('touchstart', onDown, { passive: false });
canvas.addEventListener('touchmove',  onMove, { passive: false });
canvas.addEventListener('touchend',   onUp);

// ─── INIT ────────────────────────────────────
resizeCanvas();
</script>
</body>
</html>
