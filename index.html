<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Product Customiser</title>
<link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;600&family=Playfair+Display:wght@600&display=swap" rel="stylesheet"/>
<style>
  *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

  :root {
    --bg: #f4f1ed;
    --surface: #ffffff;
    --text: #1a1a1a;
    --text-muted: #7a756e;
    --accent: #2a2a2a;
    --accent-hover: #444;
    --border: #e0dbd4;
    --shadow-lg: 0 8px 40px rgba(0,0,0,0.10);
    --radius: 14px;
    --green: #2e7d5e;
    --green-hover: #256b4e;
  }

  body {
    font-family: 'DM Sans', sans-serif;
    background: var(--bg);
    color: var(--text);
    min-height: 100vh;
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 24px;
  }

  .container {
    background: var(--surface);
    border-radius: var(--radius);
    box-shadow: var(--shadow-lg);
    max-width: 560px;
    width: 100%;
    overflow: hidden;
    animation: fadeUp 0.4s cubic-bezier(0.22,1,0.36,1);
  }

  @keyframes fadeUp {
    from { opacity:0; transform: translateY(18px); }
    to   { opacity:1; transform: translateY(0); }
  }

  .header {
    padding: 28px 28px 0;
    text-align: center;
  }
  .header h1 {
    font-family: 'Playfair Display', serif;
    font-size: 1.6rem;
    letter-spacing: -0.02em;
    color: var(--text);
  }
  .header p {
    font-size: 0.82rem;
    color: var(--text-muted);
    margin-top: 6px;
    line-height: 1.5;
  }

  .canvas-wrap {
    position: relative;
    margin: 24px 28px 0;
    background: var(--bg);
    border-radius: 10px;
    border: 1px solid var(--border);
    overflow: hidden;
    aspect-ratio: 9/16;
    cursor: crosshair;
  }
  .canvas-wrap canvas {
    display: block;
    width: 100%;
    height: 100%;
  }

  .placeholder {
    position: absolute;
    inset: 0;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    pointer-events: none;
    transition: opacity 0.3s;
  }
  .placeholder.hidden { opacity: 0; }
  .placeholder svg { width: 40px; height: 40px; opacity: 0.22; margin-bottom: 10px; }
  .placeholder span { font-size: 0.78rem; color: var(--text-muted); }

  .controls {
    display: flex;
    flex-direction: column;
    gap: 14px;
    padding: 22px 28px 28px;
  }

  .area-label {
    font-size: 0.76rem;
    color: var(--text-muted);
    font-weight: 500;
    margin-bottom: 6px;
  }
  .area-row {
    display: flex;
    gap: 8px;
  }
  .area-btn {
    flex: 1;
    padding: 9px 6px;
    border-radius: 8px;
    border: 1.5px solid var(--border);
    background: var(--surface);
    color: var(--text);
    font-family: inherit;
    font-size: 0.78rem;
    font-weight: 500;
    cursor: pointer;
    text-align: center;
    transition: all 0.18s ease;
  }
  .area-btn:hover { border-color: var(--accent); }
  .area-btn.active {
    border-color: var(--accent);
    background: var(--accent);
    color: #fff;
  }

  .btn-row {
    display: flex;
    gap: 10px;
  }

  .btn {
    flex: 1;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 7px;
    padding: 11px 16px;
    border-radius: 8px;
    border: 1.5px solid var(--border);
    background: var(--surface);
    color: var(--text);
    font-family: inherit;
    font-size: 0.8rem;
    font-weight: 500;
    cursor: pointer;
    transition: all 0.18s ease;
  }
  .btn:hover { border-color: var(--accent); background: #fafaf8; }
  .btn svg { width: 15px; height: 15px; opacity: 0.6; }

  .btn-primary {
    background: var(--accent);
    color: #fff;
    border-color: var(--accent);
  }
  .btn-primary:hover { background: var(--accent-hover); border-color: var(--accent-hover); }
  .btn-primary svg { opacity: 0.85; }

  .btn-danger { color: #c0392b; }
  .btn-danger:hover { border-color: #c0392b; background: #fdf2f1; }

  .btn-submit {
    background: var(--green);
    color: #fff;
    border-color: var(--green);
  }
  .btn-submit:hover { background: var(--green-hover); border-color: var(--green-hover); }
  .btn-submit svg { opacity: 0.85; }
  .btn-submit:disabled {
    opacity: 0.4;
    cursor: not-allowed;
  }
  .btn-submit:disabled:hover { background: var(--green); border-color: var(--green); }

  .slider-row {
    display: flex;
    align-items: center;
    gap: 12px;
  }
  .slider-row label {
    font-size: 0.76rem;
    color: var(--text-muted);
    white-space: nowrap;
    min-width: 52px;
  }
  .slider-row input[type="range"] {
    flex: 1;
    -webkit-appearance: none;
    appearance: none;
    height: 3px;
    border-radius: 2px;
    background: var(--border);
    outline: none;
  }
  .slider-row input[type="range"]::-webkit-slider-thumb {
    -webkit-appearance: none;
    appearance: none;
    width: 16px; height: 16px;
    border-radius: 50%;
    background: var(--accent);
    cursor: pointer;
    box-shadow: 0 1px 4px rgba(0,0,0,0.2);
    transition: transform 0.15s;
  }
  .slider-row input[type="range"]::-webkit-slider-thumb:hover { transform: scale(1.15); }

  .hint {
    font-size: 0.72rem;
    color: var(--text-muted);
    text-align: center;
    opacity: 0.7;
  }

  .toast {
    position: fixed;
    bottom: 32px;
    left: 50%;
    transform: translateX(-50%) translateY(80px);
    background: var(--accent);
    color: #fff;
    font-size: 0.82rem;
    font-weight: 500;
    padding: 12px 22px;
    border-radius: 8px;
    box-shadow: 0 4px 16px rgba(0,0,0,0.2);
    transition: transform 0.35s cubic-bezier(0.22,1,0.36,1);
    z-index: 100;
    white-space: nowrap;
  }
  .toast.show { transform: translateX(-50%) translateY(0); }

  #fileInput { display: none; }
</style>
</head>
<body>

<div class="container">
  <div class="header">
    <h1>Personalise Your Product</h1>
    <p>Choose a print area, upload your image, then drag and resize to position it.</p>
  </div>

  <div class="canvas-wrap" id="canvasWrap">
    <canvas id="canvas"></canvas>
    <div class="placeholder" id="placeholder">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
        <rect x="3" y="3" width="18" height="18" rx="2"/>
        <circle cx="8.5" cy="8.5" r="1.5"/>
        <path d="M21 15l-5-5L5 21"/>
      </svg>
      <span>Your preview will appear here</span>
    </div>
  </div>

  <div class="controls">
    <div>
      <div class="area-label">Choose a print area</div>
      <div class="area-row">
        <button class="area-btn active" onclick="setArea(0, this)">Area 1</button>
        <button class="area-btn"        onclick="setArea(1, this)">Area 2</button>
        <button class="area-btn"        onclick="setArea(2, this)">Area 3</button>
      </div>
    </div>

    <div class="btn-row">
      <button class="btn btn-primary" onclick="document.getElementById('fileInput').click()">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="17 8 12 3 7 8"/><line x1="12" y1="3" x2="12" y2="15"/></svg>
        Upload Image
      </button>
      <button class="btn btn-danger" id="clearBtn" onclick="clearImage()" style="display:none;">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="3 6 5 6 21 6"/><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/></svg>
        Clear
      </button>
    </div>

    <div class="slider-row" id="sliderRow" style="display:none;">
      <label>Size</label>
      <input type="range" id="sizeSlider" min="30" max="300" value="140" oninput="render()"/>
    </div>

    <button class="btn btn-submit" id="submitBtn" onclick="submitOrder()" disabled>
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/><polyline points="22 4 12 14.01 9 11.01"/></svg>
      Save My Design
    </button>

    <input type="file" id="fileInput" accept="image/*" onchange="handleUpload(event)"/>
    <p class="hint">Supported: JPG, PNG, WEBP · Max 10 MB</p>
  </div>
</div>

<div class="toast" id="toast">✓ Design saved successfully!</div>

<script>
// ═══════════════════════════════════════════════════
//  CLIP AREAS — edit these to match your product.
//  Each value is a fraction (0–1) of the canvas size:
//    x = left edge    y = top edge
//    w = width        h = height
//  Change "name" to whatever you want the button to say.
// ═══════════════════════════════════════════════════
const CLIP_AREAS = [
  { name: 'Area 1', x: 0.30, y: 0.25, w: 0.40, h: 0.45 },
  { name: 'Area 2', x: 0.15, y: 0.60, w: 0.30, h: 0.25 },
  { name: 'Area 3', x: 0.55, y: 0.60, w: 0.30, h: 0.25 }
];

// ─── STATE ───────────────────────────────────
const canvas   = document.getElementById('canvas');
const ctx      = canvas.getContext('2d');
const wrap     = document.getElementById('canvasWrap');

let userImg      = null;
let userImgData  = null;
let imgX, imgY, imgSize;
let dragging     = false;
let dragOffX     = 0, dragOffY = 0;
let activeArea   = 0;

// ─── SETUP ───────────────────────────────────
function resizeCanvas() {
  const rect = wrap.getBoundingClientRect();
  canvas.width  = rect.width;
  canvas.height = rect.height;
  render();
}
window.addEventListener('resize', resizeCanvas);

// ─── PRODUCT BASE IMAGE ──────────────────────
// ⬇️  CHANGE THIS LINE to point to your product image file:
const productImg = new Image();
productImg.src = 'IMG_1234.JPG'; // <── swap this path
productImg.onload = function() { render(); };

// ─── AREA SELECTOR ───────────────────────────
function setArea(index, btn) {
  activeArea = index;
  document.querySelectorAll('.area-btn').forEach(b => b.classList.remove('active'));
  btn.classList.add('active');
  if (userImg) {
    const a = getClipRect();
    imgX = a.x + a.w / 2;
    imgY = a.y + a.h / 2;
  }
  render();
}

function getClipRect() {
  const a = CLIP_AREAS[activeArea];
  return {
    x: a.x * canvas.width,
    y: a.y * canvas.height,
    w: a.w * canvas.width,
    h: a.h * canvas.height
  };
}

// ─── RENDER ──────────────────────────────────
function render() {
  const w = canvas.width, h = canvas.height;

  ctx.clearRect(0, 0, w, h);
  ctx.drawImage(productImg, 0, 0, w, h);

  // Dashed outline showing the active clip area
  const clip = getClipRect();
  ctx.save();
  ctx.strokeStyle = 'rgba(42,42,42,0.18)';
  ctx.lineWidth   = 1.5;
  ctx.setLineDash([6, 4]);
  ctx.beginPath();
  ctx.roundRect(clip.x, clip.y, clip.w, clip.h, 6);
  ctx.stroke();
  ctx.restore();

  // Customer's image, clipped to active area
  if (userImg) {
    document.getElementById('placeholder').classList.add('hidden');
    const size   = parseInt(document.getElementById('sizeSlider').value);
    const aspect = userImg.naturalWidth / userImg.naturalHeight;
    const dw     = size;
    const dh     = size / aspect;
    imgSize      = size;

    ctx.save();
    ctx.beginPath();
    ctx.roundRect(clip.x, clip.y, clip.w, clip.h, 6);
    ctx.clip();
    ctx.drawImage(userImg, imgX - dw/2, imgY - dh/2, dw, dh);
    ctx.restore();
  }
}

// ─── FILE UPLOAD ─────────────────────────────
function handleUpload(e) {
  const file = e.target.files[0];
  if (!file || file.size > 10*1024*1024) return alert('Please use an image under 10 MB.');

  const reader = new FileReader();
  reader.onload = function(ev) {
    userImgData = ev.target.result;
    const img = new Image();
    img.onload = function() {
      userImg = img;
      const a = getClipRect();
      imgX = a.x + a.w / 2;
      imgY = a.y + a.h / 2;
      document.getElementById('sliderRow').style.display  = 'flex';
      document.getElementById('clearBtn').style.display   = 'flex';
      document.getElementById('submitBtn').disabled       = false;
      render();
    };
    img.src = ev.target.result;
  };
  reader.readAsDataURL(file);
  e.target.value = '';
}

// ─── CLEAR ───────────────────────────────────
function clearImage() {
  userImg     = null;
  userImgData = null;
  document.getElementById('sliderRow').style.display  = 'none';
  document.getElementById('clearBtn').style.display   = 'none';
  document.getElementById('submitBtn').disabled       = true;
  document.getElementById('placeholder').classList.remove('hidden');
  render();
}

// ─── SUBMIT / SAVE ───────────────────────────
// Downloads a JSON file containing everything you need
// to reproduce the customer's design on your end.
function submitOrder() {
  const size = parseInt(document.getElementById('sizeSlider').value);
  const w    = canvas.width;
  const h    = canvas.height;

  const orderData = {
    timestamp:     new Date().toISOString(),
    selectedArea:  { index: activeArea, name: CLIP_AREAS[activeArea].name },
    clipArea:      CLIP_AREAS[activeArea],
    customerImage: userImgData,
    positioning: {
      centerX:     imgX / w,
      centerY:     imgY / h,
      size:        size,
      pixelX:      imgX,
      pixelY:      imgY,
      canvasWidth: w,
      canvasHeight: h
    }
  };

  const blob = new Blob([JSON.stringify(orderData, null, 2)], { type: 'application/json' });
  const url  = URL.createObjectURL(blob);
  const a    = document.createElement('a');
  a.href     = url;
  a.download = 'custom-order-' + new Date().toISOString().slice(0,10) + '-' + Date.now() + '.json';
  document.body.appendChild(a);
  a.click();
  document.body.removeChild(a);
  URL.revokeObjectURL(url);

  const toast = document.getElementById('toast');
  toast.classList.add('show');
  setTimeout(() => toast.classList.remove('show'), 2200);
}

// ─── DRAG ────────────────────────────────────
function getPos(e) {
  const rect   = canvas.getBoundingClientRect();
  const scaleX = canvas.width  / rect.width;
  const scaleY = canvas.height / rect.height;
  const clientX = e.touches ? e.touches[0].clientX : e.clientX;
  const clientY = e.touches ? e.touches[0].clientY : e.clientY;
  return {
    x: (clientX - rect.left) * scaleX,
    y: (clientY - rect.top)  * scaleY
  };
}

function onDown(e) {
  if (!userImg) return;
  e.preventDefault();
  const pos = getPos(e);
  dragging  = true;
  dragOffX  = pos.x - imgX;
  dragOffY  = pos.y - imgY;
  wrap.style.cursor = 'grabbing';
}

function onMove(e) {
  if (!dragging) return;
  e.preventDefault();
  const pos = getPos(e);
  imgX = pos.x - dragOffX;
  imgY = pos.y - dragOffY;
  render();
}

function onUp() {
  dragging = false;
  wrap.style.cursor = 'crosshair';
}

canvas.addEventListener('mousedown',  onDown);
canvas.addEventListener('mousemove',  onMove);
canvas.addEventListener('mouseup',    onUp);
canvas.addEventListener('mouseleave', onUp);
canvas.addEventListener('touchstart', onDown, { passive: false });
canvas.addEventListener('touchmove',  onMove, { passive: false });
canvas.addEventListener('touchend',   onUp);

// ─── INIT ────────────────────────────────────
resizeCanvas();
</script>
</body>
</html>
